{% extends "base.html" %}
{% block title %}Analiza{% endblock %}

{% block content %}
<h2>Google Analytics podaci</h2>

<h4 class="mt-4">Tablica podataka</h4>
<div class="table-responsive">
  <style>
    .table-responsive table th,git add README.md
    .table-responsive table td {
      text-align: left;   /* or "center" if you prefer */
      padding: 6px 12px;  /* optional: better spacing */
    }
  </style>
  {{ df|safe }}
</div>

<h4 class="mt-4">Top stranice (PageViews)</h4>
<canvas id="pagesChart" height="120"></canvas>

<h4 class="mt-4">Korisnici po ureÄ‘aju</h4>
<canvas id="deviceChart" height="120"></canvas>

<a href="{{ url_for('main.index') }}" class="btn btn-secondary mt-3">Natrag</a>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Flask passes df.to_html, but for charts we need raw data
const analyticsData = JSON.parse('{{ df_json|tojson | safe }}');

// Top pages chart
const pageLabels = analyticsData.map(r => r.PagePath);
const pageViews = analyticsData.map(r => parseInt(r.PageViews));

new Chart(document.getElementById("pagesChart"), {
  type: "bar",
  data: {
    labels: pageLabels,
    datasets: [{
      label: "Page Views",
      data: pageViews,
      backgroundColor: "steelblue"
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } } }
});

// Device category chart
const deviceCounts = {};
analyticsData.forEach(r => {
  const device = r.DeviceCategory || "Unknown";
  deviceCounts[device] = (deviceCounts[device] || 0) + parseInt(r.ActiveUsers);
});

new Chart(document.getElementById("deviceChart"), {
  type: "pie",
  data: {
    labels: Object.keys(deviceCounts),
    datasets: [{
      data: Object.values(deviceCounts),
      backgroundColor: ["#4e79a7","#f28e2c","#e15759"]
    }]
  }
});
</script>
{% endblock %}